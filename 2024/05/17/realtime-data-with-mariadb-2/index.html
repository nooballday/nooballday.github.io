<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Realtime Data with MariaDB and Websocket [Part 2] | Dev Journey</title><meta name="author" content="Achmad Naufal"><meta name="copyright" content="Achmad Naufal"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="IntroThis is part 2 of the “Realtime Data with Mariadb” Series, if you haven’t got the chance to read part 1 I highly recommend to read it first. WebsocketNow that we’ve successfully listened to datab">
<meta property="og:type" content="article">
<meta property="og:title" content="Realtime Data with MariaDB and Websocket [Part 2]">
<meta property="og:url" content="http://naufals.com/2024/05/17/realtime-data-with-mariadb-2/index.html">
<meta property="og:site_name" content="Dev Journey">
<meta property="og:description" content="IntroThis is part 2 of the “Realtime Data with Mariadb” Series, if you haven’t got the chance to read part 1 I highly recommend to read it first. WebsocketNow that we’ve successfully listened to datab">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://naufals.com/images/realtime_db.svg">
<meta property="article:published_time" content="2024-05-17T06:59:50.000Z">
<meta property="article:modified_time" content="2025-11-24T04:45:01.252Z">
<meta property="article:author" content="Achmad Naufal">
<meta property="article:tag" content="java">
<meta property="article:tag" content="mariadb">
<meta property="article:tag" content="micronaut">
<meta property="article:tag" content="websocket">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://naufals.com/images/realtime_db.svg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Realtime Data with MariaDB and Websocket [Part 2]",
  "url": "http://naufals.com/2024/05/17/realtime-data-with-mariadb-2/",
  "image": "http://naufals.com/images/realtime_db.svg",
  "datePublished": "2024-05-17T06:59:50.000Z",
  "dateModified": "2025-11-24T04:45:01.252Z",
  "author": [
    {
      "@type": "Person",
      "name": "Achmad Naufal",
      "url": "http://naufals.com"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="http://naufals.com/2024/05/17/realtime-data-with-mariadb-2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Realtime Data with MariaDB and Websocket [Part 2]',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="web_bg" style="background-image: url(/url(/images/bg_web_1.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/profile-picture.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/images/realtime_db.svg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Dev Journey</span></a><a class="nav-page-title" href="/"><span class="site-name">Realtime Data with MariaDB and Websocket [Part 2]</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Realtime Data with MariaDB and Websocket [Part 2]</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-05-17T06:59:50.000Z" title="Created 2024-05-17 13:59:50">2024-05-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-24T04:45:01.252Z" title="Updated 2025-11-24 11:45:01">2025-11-24</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>This is part 2 of the “Realtime Data with Mariadb” Series, if you haven’t got the chance to read <a target="_blank" rel="noopener" href="https://www.naufals.com/2024/05/12/mariadb-with-realtime-data/">part 1</a> I highly recommend to read it first.</p>
<h3 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h3><p>Now that we’ve successfully listened to database changes, we want to streamline it with WebSocket.</p>
<p>In this example I am using Micronaut’s websocket feature, you are obviously free to choose any framework or even implement it yourself.</p>
<p>As usual all the code in this article will be available <a target="_blank" rel="noopener" href="https://github.com/nooballday/realtimedatastore">here</a></p>
<h3 id="Project-Setup"><a href="#Project-Setup" class="headerlink" title="Project Setup"></a>Project Setup</h3><p>Let’s start by creating a micronaut project.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mn create-app realtimemariadb --features=yaml &amp;&amp; <span class="built_in">cd</span> realtimemariadb</span><br></pre></td></tr></table></figure>

<p>We are going to introduce new dependencies, add these lines to your <code>build.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> implementation (<span class="string">&quot;org.mariadb.jdbc:mariadb-java-client:3.0.3&quot;</span>) <span class="comment">// MariaDB JDBC driver</span></span><br><span class="line"> implementation (<span class="string">&quot;org.springframework.boot:spring-boot-starter-jdbc:3.2.5&quot;</span>)</span><br><span class="line"> runtimeOnly(<span class="string">&quot;io.micronaut.sql:micronaut-jdbc-hikari&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>We need those dependencies to run queries to our database.</p>
<p>The next step is modifying our <code>application.yml</code> add these lines for our database config.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">datasources:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mariadb://localhost:3306/aschema</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">org.mariadb.jdbc.Driver</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">schema:</span> <span class="string">aschema</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">dialect:</span> <span class="string">MYSQL</span></span><br></pre></td></tr></table></figure>

<h3 id="Database-Listener"><a href="#Database-Listener" class="headerlink" title="Database Listener"></a>Database Listener</h3><p>In the previous part, we created our database listener in <code>Application.java</code> file, we are going to move it to a new File since we going to implement Micronaut’s <code>ApplicationEventListener</code> class. This will run our listener after Micronaut has finished starting.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> realtimemariadb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.shyiko.mysql.binlog.BinaryLogClient;</span><br><span class="line"><span class="keyword">import</span> com.github.shyiko.mysql.binlog.event.Event;</span><br><span class="line"><span class="keyword">import</span> com.github.shyiko.mysql.binlog.event.EventType;</span><br><span class="line"><span class="keyword">import</span> com.github.shyiko.mysql.binlog.event.QueryEventData;</span><br><span class="line"><span class="keyword">import</span> com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer;</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.event.ApplicationEventListener;</span><br><span class="line"><span class="keyword">import</span> io.micronaut.runtime.server.event.ServerStartupEvent;</span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.JSQLParserException;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.parser.CCJSqlParserUtil;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.statement.Statement;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.statement.delete.Delete;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.statement.insert.Insert;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.statement.update.Update;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">//this class will run after micronaut has finished starting</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventListener</span>&lt;ServerStartupEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MainChannel mainChannel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataRepository repository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DatasourceConfig datasourceConfig;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DatabaseListener</span><span class="params">(MainChannel mainChannel, DataRepository repository, DatasourceConfig datasourceConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mainChannel = mainChannel;</span><br><span class="line">        <span class="built_in">this</span>.repository = repository;</span><br><span class="line">        <span class="built_in">this</span>.datasourceConfig = datasourceConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(DatabaseListener.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ServerStartupEvent event)</span> &#123;</span><br><span class="line">        listen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">BinaryLogClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryLogClient</span>(</span><br><span class="line">                datasourceConfig.getHost(),</span><br><span class="line">                <span class="number">3306</span>,</span><br><span class="line">                datasourceConfig.getSchema(),</span><br><span class="line">                datasourceConfig.getUsername(),</span><br><span class="line">                datasourceConfig.getPassword());</span><br><span class="line"></span><br><span class="line">        <span class="type">EventDeserializer</span> <span class="variable">eventDeserializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventDeserializer</span>();</span><br><span class="line">        eventDeserializer.setCompatibilityMode(</span><br><span class="line">                EventDeserializer.CompatibilityMode.DATE_AND_TIME_AS_LONG,</span><br><span class="line">                EventDeserializer.CompatibilityMode.CHAR_AND_BINARY_AS_BYTE_ARRAY);</span><br><span class="line">        client.setEventDeserializer(eventDeserializer);</span><br><span class="line">        client.registerEventListener(<span class="keyword">new</span> <span class="title class_">BinaryLogClient</span>.EventListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(Event event)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (event.getHeader().getEventType() == EventType.QUERY) &#123;</span><br><span class="line">                    <span class="type">QueryEventData</span> <span class="variable">queryEventData</span> <span class="operator">=</span> event.getData();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// parse the query from the event</span></span><br><span class="line">                    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        statement = CCJSqlParserUtil.parse(queryEventData.getSql());</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (JSQLParserException e) &#123;</span><br><span class="line">                        LOG.error(String.format(<span class="string">&quot;Error when parsing query event data : %s&quot;</span>, e.getMessage()));</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// get query type so we can cast statement to the appropriate class</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">queryType</span> <span class="operator">=</span> statement.getClass().getSimpleName().toUpperCase();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">switch</span> (queryType) &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;INSERT&quot;</span>:</span><br><span class="line">                            <span class="type">Insert</span> <span class="variable">insertStatement</span> <span class="operator">=</span> (Insert) statement;</span><br><span class="line">                            tableName = insertStatement.getTable().getName();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;DELETE&quot;</span>:</span><br><span class="line">                            <span class="type">Delete</span> <span class="variable">deleteStatement</span> <span class="operator">=</span> (Delete) statement;</span><br><span class="line">                            tableName = deleteStatement.getTable().getName();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;UPDATE&quot;</span>:</span><br><span class="line">                            <span class="type">Update</span> <span class="variable">updateStatement</span> <span class="operator">=</span> (Update) statement;</span><br><span class="line">                            tableName = updateStatement.getTable().getName();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                            System.out.println(String.format(<span class="string">&quot;unsupported query to watch %s&quot;</span>, queryType));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// broadcast event</span></span><br><span class="line">                    <span class="type">DataEvent</span> <span class="variable">dataEvent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataEvent</span>(tableName, repository.fetchData(tableName));</span><br><span class="line">                    System.out.println(String.format(<span class="string">&quot;Data changes on table %s&quot;</span>, dataEvent.getData()));</span><br><span class="line">                    mainChannel.broadcast(dataEvent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.connect();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOG.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Websocket-Server"><a href="#Websocket-Server" class="headerlink" title="Websocket Server"></a>Websocket Server</h3><p>We are going to make a very simple WebSocket server that listens to a connection open, and any messages that come to our service.</p>
<p><code>WebSocketServer.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> realtimemariadb;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.WebSocketSession;</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnClose;</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnMessage;</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnOpen;</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.ServerWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerWebSocket(&quot;/channel/&#123;userName&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MainChannel mainChannel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(WebSocketServer.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSocketServer</span><span class="params">(MainChannel mainChannel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mainChannel = mainChannel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(String userName, WebSocketSession session)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> String.format(<span class="string">&quot;User %s joined!&quot;</span>, userName);</span><br><span class="line">        LOG.info(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String userName, String tableName, WebSocketSession session)</span> &#123;</span><br><span class="line">        <span class="comment">//every message that comes will be assumed as subscription</span></span><br><span class="line">        <span class="type">Subscription</span> <span class="variable">subscription</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Subscription</span>(session, tableName);</span><br><span class="line">        LOG.info(String.format(<span class="string">&quot;User %s subscribing on table %s&quot;</span>, userName, tableName));</span><br><span class="line">        mainChannel.subscribe(subscription);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(String userName, WebSocketSession session)</span>  &#123;</span><br><span class="line">        mainChannel.unsubscribe(session.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we are going to implement our channel, which will broadcast the changes to subscribed clients.</p>
<p><code>MainChannel.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> realtimemariadb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.WebSocketBroadcaster;</span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainChannel</span> <span class="keyword">implements</span> <span class="title class_">Channel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//in-memory store that records active subscription</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Set&lt;Subscription&gt;&gt; subscriptions = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MainChannel</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">        <span class="comment">//register active subscription</span></span><br><span class="line">        Set&lt;Subscription&gt; ss = subscriptions.get(subscription.getTableName());</span><br><span class="line">        <span class="keyword">if</span> (ss != <span class="literal">null</span>) &#123;</span><br><span class="line">            ss.add(subscription);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//<span class="doctag">TODO:</span> need to check if table exists</span></span><br><span class="line">            subscriptions.put(subscription.getTableName(), Set.of(subscription));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//it only handles tableName for now</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">broadcast</span><span class="params">(DataEvent dataEvent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (dataEvent == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//broadcast changes to subscribed users</span></span><br><span class="line">        Set&lt;Subscription&gt; subscribed = subscriptions.get(dataEvent.getTableName());</span><br><span class="line">        <span class="keyword">if</span> (subscribed != <span class="literal">null</span>) &#123;</span><br><span class="line">            subscribed.forEach(s -&gt; &#123;</span><br><span class="line">                <span class="comment">//send to each client</span></span><br><span class="line">                s.getWebsocketSession().sendSync(dataEvent);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unsubscribe</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="comment">//when the user disconnects, delete all entries from subscription</span></span><br><span class="line">        subscriptions.forEach((key, value) -&gt; &#123;</span><br><span class="line">            <span class="comment">//remove session from subscription</span></span><br><span class="line">            Set&lt;Subscription&gt; mValue = value.stream().filter( v -&gt; v.getSessionId() != sessionId).collect(Collectors.toSet());</span><br><span class="line">            subscriptions.put(key, mValue);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now try to run the code with</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :run</span><br></pre></td></tr></table></figure>

<p>If everything is correct, you will see these messages</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :run</span><br><span class="line"> __  __ _                                  _</span><br><span class="line">|  \/  (_) ___ _ __ ___  _ __   __ _ _   _| |_</span><br><span class="line">| |\/| | |/ __| <span class="string">&#x27;__/ _ \| &#x27;</span>_ \ / _` | | | | __|</span><br><span class="line">| |  | | | (__| | | (_) | | | | (_| | |_| | |_</span><br><span class="line">|_|  |_|_|\___|_|  \___/|_| |_|\__,_|\__,_|\__|</span><br><span class="line">14:54:44.097 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...</span><br><span class="line">14:54:44.163 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.mariadb.jdbc.Connection@20a14b55</span><br><span class="line">14:54:44.165 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.</span><br><span class="line">May 17, 2024 2:54:44 PM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to localhost:3306 at mylog-bin.000004/342 (sid:65535, cid:43)</span><br><span class="line">&lt;==========---&gt; 80% EXECUTING [10s]</span><br><span class="line">&gt; :run</span><br></pre></td></tr></table></figure>

<h3 id="The-client"><a href="#The-client" class="headerlink" title="The client"></a>The client</h3><p>Let’s build a simple websocket client in node.js.</p>
<p>In the example below I am subscribing to the user table.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create a node project and add &#x27;ws&#x27; dependency</span></span><br><span class="line">yarn init -y &amp;&amp; yarn add ws</span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">WebSocket</span> = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080/channel/UserNode&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">on</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> <span class="title function_">open</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Connected to server&#x27;</span>);</span><br><span class="line">  ws.<span class="title function_">send</span>(<span class="string">&#x27;user&#x27;</span>);<span class="comment">//subscribe to user `table`</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span> <span class="title function_">incoming</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="comment">//incoming data changes</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(data.<span class="title function_">toString</span>(<span class="string">&quot;utf-8&quot;</span>)).<span class="property">data</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Disconnected from server&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Start the node project</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>

<p>If the client is connected to our WebSocket server, you will see this message</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">15:00:47.585 [default-nioEventLoopGroup-1-2] INFO  realtimemariadb.WebSocketServer - User UserNode joined!</span><br><span class="line">15:00:47.600 [default-nioEventLoopGroup-1-2] INFO  realtimemariadb.WebSocketServer - User UserNode subscribing on table user</span><br></pre></td></tr></table></figure>

<p>Now try modifying your database.</p>
<p><img src="/images/example-realtime.gif" alt="realtime-data"></p>
<p>Congrats, now you’ve built a realtime database service.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nooballday/realtimedatastore">Source code</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://naufals.com">Achmad Naufal</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://naufals.com/2024/05/17/realtime-data-with-mariadb-2/">http://naufals.com/2024/05/17/realtime-data-with-mariadb-2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/mariadb/">mariadb</a><a class="post-meta__tags" href="/tags/micronaut/">micronaut</a><a class="post-meta__tags" href="/tags/websocket/">websocket</a></div><div class="post-share"><div class="social-share" data-image="/images/realtime_db.svg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/09/15/reactive-database-transaction-with-vertx/" title="Reactive database transaction with Vertx"><img class="cover" src="/images/sql_image.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Reactive database transaction with Vertx</div></div><div class="info-2"><div class="info-item-1">IntroRecently I needed to create an app using Micronaut’s Reactor for my work, fundamentally it makes your JVM application run in an unblocking manner and thus increases the throughput. The project needs to do database transactions and since documentation does not contain the integration with Micronaut’s reactor core library, I am writing this post. If you want to check the documentation from the micronaut page you can check this link. The codeI am writing this in Groovy, but it will be simil...</div></div></div></a><a class="pagination-related" href="/2024/05/12/mariadb-with-realtime-data/" title="Realtime Data with MariaDB and Websocket [Part 1]"><img class="cover" src="/images/realtime_bg_1.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Realtime Data with MariaDB and Websocket [Part 1]</div></div><div class="info-2"><div class="info-item-1">GoalWe are going to learn and build a service that serves real-time data with MariaDB as the underlying database. Why?User expectations are increasing, and real-time data has become mandatory for a great web application. In this article, we are going to see possible options to build real-time data that serves data with MariaDB as our database. There are a lot of software that offers this kind of real-time feature, one of them is debezium another is supabase, but we are going to create it our ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/05/12/mariadb-with-realtime-data/" title="Realtime Data with MariaDB and Websocket [Part 1]"><img class="cover" src="/images/realtime_bg_1.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-12</div><div class="info-item-2">Realtime Data with MariaDB and Websocket [Part 1]</div></div><div class="info-2"><div class="info-item-1">GoalWe are going to learn and build a service that serves real-time data with MariaDB as the underlying database. Why?User expectations are increasing, and real-time data has become mandatory for a great web application. In this article, we are going to see possible options to build real-time data that serves data with MariaDB as our database. There are a lot of software that offers this kind of real-time feature, one of them is debezium another is supabase, but we are going to create it our ...</div></div></div></a><a class="pagination-related" href="/2024/03/09/totp-web-service-part-one/" title="Building Authentication Service with TOTP (Time-Based OTP) Part 1. The Server"><img class="cover" src="/images/authentication.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-09</div><div class="info-item-2">Building Authentication Service with TOTP (Time-Based OTP) Part 1. The Server</div></div><div class="info-2"><div class="info-item-1">Series Building Authentication Service with TOTP (Time-Based OTP) Part 1. The Server Building Authentication Service with TOTP (Time-Based OTP) Part 2. The Client  Pre-requisite Java 17 Micronaut  Goal In this two-part series, we are going to build a web application and a REST API service. After finishing this series hopefully, we get a better understanding of what TOTP is and how to implement it. We are going to build the REST API using Java with Micronaut framework and the Web App using the...</div></div></div></a><a class="pagination-related" href="/2024/04/07/idempotency-prevent-duplicate-request/" title="How to Prevent Duplicate Data with Idempotency Key"><img class="cover" src="/images/duplicate_key_1.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-07</div><div class="info-item-2">How to Prevent Duplicate Data with Idempotency Key</div></div><div class="info-2"><div class="info-item-1">What is idempotency ? Idempotence is the property of certain operations in mathematics and computer science whereby they can be applied multiple times without changing the result beyond the initial application.  When 2 identical requests are sent almost at the same time, your service must handle them accordingly, for example, if a web app sends a duplicate request to book (due to various reasons) a movie ticket, the service must understand which request should be accepted and only process one...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/profile-picture.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Achmad Naufal</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/nooballday"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:naufal3dev@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/naufal3dev" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin" style="color: #24292e;"></i></a><a class="social-icon" href="https://steamcommunity.com/profiles/76561199242373857" target="_blank" title="Steam"><i class="fa-brands fa-steam" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Feel free to contact me for ideas / discussions</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Intro"><span class="toc-number">1.</span> <span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Websocket"><span class="toc-number">2.</span> <span class="toc-text">Websocket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Project-Setup"><span class="toc-number">3.</span> <span class="toc-text">Project Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Database-Listener"><span class="toc-number">4.</span> <span class="toc-text">Database Listener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Websocket-Server"><span class="toc-number">5.</span> <span class="toc-text">Websocket Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-client"><span class="toc-number">6.</span> <span class="toc-text">The client</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/24/glass-door/" title="Glass Door"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Glass Door"/></a><div class="content"><a class="title" href="/2025/11/24/glass-door/" title="Glass Door">Glass Door</a><time datetime="2025-11-24T04:52:50.000Z" title="Created 2025-11-24 11:52:50">2025-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/15/reactive-database-transaction-with-vertx/" title="Reactive database transaction with Vertx"><img src="/images/sql_image.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Reactive database transaction with Vertx"/></a><div class="content"><a class="title" href="/2024/09/15/reactive-database-transaction-with-vertx/" title="Reactive database transaction with Vertx">Reactive database transaction with Vertx</a><time datetime="2024-09-15T04:45:14.000Z" title="Created 2024-09-15 11:45:14">2024-09-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/17/realtime-data-with-mariadb-2/" title="Realtime Data with MariaDB and Websocket [Part 2]"><img src="/images/realtime_db.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Realtime Data with MariaDB and Websocket [Part 2]"/></a><div class="content"><a class="title" href="/2024/05/17/realtime-data-with-mariadb-2/" title="Realtime Data with MariaDB and Websocket [Part 2]">Realtime Data with MariaDB and Websocket [Part 2]</a><time datetime="2024-05-17T06:59:50.000Z" title="Created 2024-05-17 13:59:50">2024-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/12/mariadb-with-realtime-data/" title="Realtime Data with MariaDB and Websocket [Part 1]"><img src="/images/realtime_bg_1.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Realtime Data with MariaDB and Websocket [Part 1]"/></a><div class="content"><a class="title" href="/2024/05/12/mariadb-with-realtime-data/" title="Realtime Data with MariaDB and Websocket [Part 1]">Realtime Data with MariaDB and Websocket [Part 1]</a><time datetime="2024-05-12T12:58:47.000Z" title="Created 2024-05-12 19:58:47">2024-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/07/idempotency-prevent-duplicate-request/" title="How to Prevent Duplicate Data with Idempotency Key"><img src="/images/duplicate_key_1.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="How to Prevent Duplicate Data with Idempotency Key"/></a><div class="content"><a class="title" href="/2024/04/07/idempotency-prevent-duplicate-request/" title="How to Prevent Duplicate Data with Idempotency Key">How to Prevent Duplicate Data with Idempotency Key</a><time datetime="2024-04-07T03:08:57.000Z" title="Created 2024-04-07 10:08:57">2024-04-07</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2025 By Achmad Naufal</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><div class="js-pjax"></div></div></body></html>